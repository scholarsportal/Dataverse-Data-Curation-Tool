<div class="fixed bg-white top-0 pt-20 z-30 w-screen flex flex-row justify-around">
    <!-- Filter Search -->
    <label class="my-auto">Filter
        <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input />
    </label>
    <!-- Group Selection Dropdown -->
    <select *ngIf="selection.selected.length" name="groups" id="" class="bg-gray-100 border border-gray-300 rounded-md h-max p-1.5 my-auto">
        <option value="">Add to Group</option>
        <option *ngFor="let item of groups$ | async | keyvalue" id="{{ item.key }}" (click)="addToGroup(item.value)">{{ getLabel(item.value) }}</option>
    </select>
    <button *ngIf="selection.selected.length && (selectedGroup$ | async)"
            class="bg-gray-100 h-max rounded-md border border-gray-300 p-1.5 my-auto"
            (click)="removeFromGroup()"
    >
        Remove From Variable Group</button>
    <!-- Paginator -->
    <mat-paginator [pageSizeOptions]="[15, 30, 50, 100]" aria-label="Select variable page"></mat-paginator>
</div>

<mat-table [dataSource]="vars" matSort class="w-full relative top-6">
    <tr mat-header-row *matHeaderRowDef="columnMat;" class=""></tr>
    <tr mat-row *matRowDef="let row; columns: columnMat" class=""></tr>

    <!-- Row shown when there is no matching data. -->
    <tr mat-row *matNoDataRow>
        <td mat-cell colspan="4">
            No data matching the filter "{{ input.value }}"
        </td>
    </tr>

    <!-- Checkbox Column -->
    <ng-container matColumnDef="check">
        <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="$event ? toggleAllRows() : null" [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
            </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row['@_ID']) : null"
                [checked]="selection.isSelected(row['@_ID'])" [aria-label]="checkboxLabel(row['@_ID'])">
            </mat-checkbox>
        </td>
    </ng-container>

    <!-- ID Column -->
    <ng-container matColumnDef="ID">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="id">ID</th>
        <td mat-cell *matCellDef="let row">{{ row['@_ID'] }}</td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="Name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="name">Name</th>
        <td mat-cell *matCellDef="let row">{{ row['@_name'] }}</td>
    </ng-container>

    <!-- Label Column -->
    <ng-container matColumnDef="Label">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="label">Label</th>
        <td mat-cell *matCellDef="let row">{{ row['labl']['#text'] }}</td>
    </ng-container>

    <!-- Weight Column -->
    <ng-container matColumnDef="Weight">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="weight">Weight</th>
        <td mat-cell *matCellDef="let row">
            {{ row['@_wgt-var'] ? row['@_wgt-var'] : '' }}
        </td>
    </ng-container>

    <!-- View Column -->
    <ng-container matColumnDef="View">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>View</th>
        <td mat-cell *matCellDef="let row">
            <button (click)="viewChart(row)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" />
                </svg>
            </button>
        </td>
    </ng-container>

    <!-- Edit Column -->
    <ng-container matColumnDef="Edit">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Edit Variable</th>
        <td mat-cell *matCellDef="let row">
            <button (click)="editVar(row)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                </svg>
            </button>
        </td>
    </ng-container>
</mat-table>

<app-modal class="w-max">
    <!-- MODAL HEADER -->
    <div class="modal-header flex flex-col">
        <div class="text-2xl">{{ heading }}</div>
    </div>

    <!-- MAIN MODAL SECTION -->
    <div class="modal-body">
        <app-form *ngIf="isEditing$ | async; else chart"></app-form>
        <ng-template #chart>
            <app-chart></app-chart>
        </ng-template>
    </div>

    <!-- MODAL FOOTER -->
    <div class="modal-footer">
        <button (click)="close()">Update</button>
        <button (click)="close()">Cancel</button>
    </div>
</app-modal>
